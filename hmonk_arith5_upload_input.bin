hmonk
COMEFROM
run /bin/umodem arith5.adv EOF
{ comments are enclosed by curly-braces;
  no nested comments are allowed  }

{ evaluation entry point }
Compute x => Eval x Done;

{ evaluate expressions first }
Eval (Add x y) k => Eval x (KAdd y k);
Eval (Mult x y) k => Eval x (KMult y k);

{ values }
Eval v k => Apply k v;

{ evaluate addition }
Apply (KAdd y k) v => Eval y (KAdd2 v k);
Apply (KAdd2 v k) w => AddN v w k;

{ numeric addition }
AddN Z w k => Apply k w;
AddN (S x) w k => AddN x (S w) k;

{ evaluate multiplication }
Apply (KMult y k) v => Eval y (KMult2 v k);
Apply (KMult2 v k) w => MulAcc v w Z k;

{ numeric multiplication via accumulator }
MulAcc Z w acc k => Apply k acc;
MulAcc (S x) w acc k => AddN w acc (MulAcc x w k);
Apply (MulAcc x w k) acc => MulAcc x w acc k;

{ finish }
Apply Done v => v;

. { end of rules }
EOF
advise arith arith5.adv arith.tests
